!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.AudioFX=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();!function(){if(!Array.prototype.find){var e=function(e){var t=Object(this),o=t.length<0?0:t.length>>>0;if(0===o)return void 0;if("function"!=typeof e||"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError("Array#find: predicate must be a function");for(var i,n=arguments[1],r=0;o>r;r++)if(i=t[r],e.call(n,i,r,t))return i;return void 0};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"find",{value:e,configurable:!0,enumerable:!1,writable:!0})}catch(t){}Array.prototype.find||(Array.prototype.find=e)}}();var o=function(){function o(t,i,n){e(this,o),this["const"]={QUALITY_MULTIPLIER:30};var r={loop:!1,volume:1,filterFrequency:null,autoplay:!1};if(this.options=o.isObject(n)?o.extend(r,n):r,this.playing=!1,this.hasLoaded=!1,!window.AudioFXGlobal){window.AudioFXGlobal={},window.AudioFXGlobal.cache=[];try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioFXGlobal.context=new AudioContext}catch(u){o.error("Web Audio API Error: "+u.message)}}"string"!=typeof t?o.error("You have to provide a valid url string."):this.url=t,i&&(o.isFunction(i)?this.onload=i:o.error("Supplied callback is not a function.")),this.buffer=null,this.duration=0,this.source=null,window.AudioFXGlobal.context.createGain||(window.AudioFXGlobal.context.createGain=window.AudioFXGlobal.context.createGainNode),this.gainNode=window.AudioFXGlobal.context.createGain(),this.gainNode.gain.value=this.options.volume,this.filterNode=window.AudioFXGlobal.context.createBiquadFilter(),this.filterNode.type="string"==typeof this.filterNode.type?"lowpass":0,this.filterNode.frequency.value=this.options.filterFrequency?this.options.filterFrequency:window.AudioFXGlobal.context.sampleRate,this._pauseTime=0,this.id=window.AudioFXGlobal.cache.length+1;var a=window.AudioFXGlobal.cache.find(function(e){return e.url===t});window.AudioFXGlobal.cache.length>0&&a?(this.hasLoaded=!0,this.setBuffer(a.buffer)):this.loadFile(t)}return t(o,[{key:"loadFile",value:function(e){this.request=new XMLHttpRequest,this.request.open("GET",e,!0),this.request.responseType="arraybuffer";var t=this;this.request.onload=function(){window.AudioFXGlobal.context.decodeAudioData(t.request.response,function(e){t.setBuffer(e)},function(e){o.error("Error at decodeAudioData"+e)})},this.request.onerror=function(){o.error("XMLHttpRequest errored. Readystate: "+this.readyState+". Status: "+this.status)},this.request.send()}},{key:"setBuffer",value:function(e){return e||o.error("No Buffer found."),window.AudioFXGlobal.cache.push(this),this.buffer=o.clone(e),this.duration=parseFloat(e.duration),this.hasLoaded=!0,this.options.autoplay===!0&&this.play(),o.isFunction(this.onload)&&this.onload(this),this}},{key:"createAndConnectNodes",value:function(){this.source=window.AudioFXGlobal.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.filterNode),this.filterNode.connect(this.gainNode),this.gainNode.connect(window.AudioFXGlobal.context.destination)}},{key:"play",value:function(){var e=void 0===arguments[0]?0:arguments[0];return this.playing===!0&&this.stop(),this.createAndConnectNodes(),this.options.loop&&(this.source.loop=!0),this.source.start||(this.source.start=this.source.noteOn),this._pauseTime?this.source.start(0,this._pauseTime):this.source.start(0,e),this._playTime=window.AudioFXGlobal.context.currentTime,this.playing=!0,this}},{key:"pause",value:function(){if(this._playTime){var e=window.AudioFXGlobal.context.currentTime-this._playTime;this._pauseTime=this._pauseTime+e,this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(),this.playing=!1}}},{key:"stop",value:function(){var e=void 0===arguments[0]?0:arguments[0];return this.source.stop||(this.source.stop=this.source.noteOff),this._pauseTime=null,this.source.stop(e),this.playing=!1,this}},{key:"toggle",value:function(){return this.playing===!0?this.pause():this.play(),this}},{key:"changeVolume",value:function(e){var t=parseFloat(e);return t>1?t=1:0>t&&(t=0),this.gainNode.gain.value=t*t,this}},{key:"changeFilter",value:function(e,t){var o=40,i=window.AudioFXGlobal.context.sampleRate/2,n=Math.log(i/o)/Math.LN2,r=Math.pow(2,n*(e-1));return this.filterNode.frequency.value=i*r,this.filterNode.Q.value=t*this["const"].QUALITY_MULTIPLIER,this}},{key:"getCurrentTime",value:function(){return this.playing?this._pauseTime+(window.AudioFXGlobal.context.currentTime-this._playTime):this._pauseTime}},{key:"getDuration",value:function(){return this.duration}},{key:"destroy",value:function(){this.playing&&this.stop(),window.AudioFXGlobal.cache.splice(window.AudioFXGlobal.cache.indexOf(this),1);for(var e in this)this.hasOwnProperty(e)&&delete this[e]}},{key:"volume",value:function(e){return this.changeVolume(e)}},{key:"filter",value:function(e,t){return this.changeFilter(e,t)}},{key:"kill",value:function(){return this.destroy()}},{key:"remove",value:function(){return this.destroy()}}],[{key:"destroyAll",value:function(){window.AudioFXGlobal.cache.forEach(function(e){e.destroy()})}},{key:"extend",value:function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e}},{key:"clone",value:function(e){for(var t=window.AudioFXGlobal.context.createBuffer(e.numberOfChannels,e.length,e.sampleRate),o=0,i=e.numberOfChannels;i>o;++o){var n=t.getChannelData(o),r=e.getChannelData(o);n.set(r,0)}return t}},{key:"isObject",value:function(e){return null!==e&&"object"==typeof e}},{key:"isFunction",value:function(e){var t={};return e&&"[object Function]"===t.toString.call(e)}},{key:"error",value:function(e){throw new Error("AudioFX: Error! "+e)}}]),o}();return o});