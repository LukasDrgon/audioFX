!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.AudioFX=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),i=function(){function i(){e(this,i),this.cache=[];try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext}catch(t){o.error("Web Audio API Error: "+t.message)}this.context.createGain||(this.context.createGain=this.context.createGainNode)}return t(i,[{key:"changeVolumeAll",value:function(e){return this.cache.forEach(function(t){t.volume(e)}),this}},{key:"destroyAll",value:function(){return this.cache.forEach(function(e){e.destroy()}),this}}]),i}();!function(){if(!Array.prototype.find){var e=function(e){var t=Object(this),i=t.length<0?0:t.length>>>0;if(0===i)return void 0;if("function"!=typeof e||"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError("Array#find: predicate must be a function");for(var o,n=arguments[1],r=0;i>r;r++)if(o=t[r],e.call(n,o,r,t))return o;return void 0};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"find",{value:e,configurable:!0,enumerable:!1,writable:!0})}catch(t){}Array.prototype.find||(Array.prototype.find=e)}}();var o=function(){function o(t,n,r){e(this,o),this["const"]={QUALITY_MULTIPLIER:30};var s={loop:!1,volume:1,filterFrequency:null,autoplay:!1,onEnded:null};this.options=o.isObject(r)?o.extend(s,r):s,this.playing=!1,this.hasLoaded=!1,window.AudioFXGlobal||(window.AudioFXGlobal=new i),"string"!=typeof t?o.error("You have to provide a valid url string."):this.url=t,n&&(o.isFunction(n)?this.onload=n:o.error("Supplied callback is not a function.")),this.buffer=null,this.duration=0,this.source=null,this.gainNode=window.AudioFXGlobal.context.createGain(),this.gainNode.gain.value=this.options.volume,this.filterNode=window.AudioFXGlobal.context.createBiquadFilter(),this.filterNode.type="string"==typeof this.filterNode.type?"lowpass":0,this.filterNode.frequency.value=this.options.filterFrequency?this.options.filterFrequency:window.AudioFXGlobal.context.sampleRate,this._pauseTime=0,this.id=window.AudioFXGlobal.cache.length+1;var u=window.AudioFXGlobal.cache.find(function(e){return e.url===t});window.AudioFXGlobal.cache.length>0&&u?(this.hasLoaded=!0,this.setBuffer(u.buffer)):this.loadFile(t)}return t(o,[{key:"loadFile",value:function(e){this.request=new XMLHttpRequest,this.request.open("GET",e,!0),this.request.responseType="arraybuffer";var t=this;this.request.onload=function(){window.AudioFXGlobal.context.decodeAudioData(t.request.response,function(e){t.setBuffer(e)},function(e){o.error("Error at decodeAudioData"+e)})},this.request.onerror=function(){o.error("XMLHttpRequest errored. Readystate: "+this.readyState+". Status: "+this.status)},this.request.send()}},{key:"setBuffer",value:function(e){return e||o.error("No Buffer found."),window.AudioFXGlobal.cache.push(this),this.buffer=o.clone(e),this.duration=parseFloat(e.duration),this.hasLoaded=!0,this.options.autoplay===!0&&this.play(),o.isFunction(this.onload)&&this.onload(this),this}},{key:"bufferEnded",value:function(){this.playing=!1,null!==this.options.onEnded&&this.options.onEnded()}},{key:"createAndConnectNodes",value:function(){this.source=window.AudioFXGlobal.context.createBufferSource(),this.source.buffer=this.buffer,this.source.onended=this.bufferEnded.bind(this),this.source.connect(this.filterNode),this.filterNode.connect(this.gainNode),this.gainNode.connect(window.AudioFXGlobal.context.destination)}},{key:"play",value:function(){var e=void 0===arguments[0]?0:arguments[0];return this.playing===!0&&this.stop(),this.createAndConnectNodes(),this.options.loop&&(this.source.loop=!0),this.source.start||(this.source.start=this.source.noteOn),this._pauseTime?this.source.start(0,this._pauseTime):this.source.start(0,e),this._playTime=window.AudioFXGlobal.context.currentTime,this.playing=!0,this}},{key:"pause",value:function(){if(this._playTime){var e=window.AudioFXGlobal.context.currentTime-this._playTime;this._pauseTime=this._pauseTime+e,this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(),this.playing=!1}}},{key:"stop",value:function(){var e=void 0===arguments[0]?0:arguments[0];return this.source.stop||(this.source.stop=this.source.noteOff),this._pauseTime=null,this.source.stop(e),this.playing=!1,this}},{key:"toggle",value:function(){return this.playing===!0?this.pause():this.play(),this}},{key:"changeVolume",value:function(e){var t=parseFloat(e);return t>1?t=1:0>t&&(t=0),this.gainNode.gain.value=t*t,this}},{key:"changeFilter",value:function(e,t){var i=40,o=window.AudioFXGlobal.context.sampleRate/2,n=Math.log(o/i)/Math.LN2,r=Math.pow(2,n*(e-1));return this.filterNode.frequency.value=o*r,this.filterNode.Q.value=t*this["const"].QUALITY_MULTIPLIER,this}},{key:"getCurrentTime",value:function(){return this.playing?this._pauseTime+(window.AudioFXGlobal.context.currentTime-this._playTime):this._pauseTime}},{key:"getDuration",value:function(){return this.duration}},{key:"destroy",value:function(){this.playing&&this.stop(),window.AudioFXGlobal.cache.splice(window.AudioFXGlobal.cache.indexOf(this),1);for(var e in this)this.hasOwnProperty(e)&&delete this[e]}},{key:"volume",value:function(e){return this.changeVolume(e)}},{key:"filter",value:function(e,t){return this.changeFilter(e,t)}},{key:"kill",value:function(){return this.destroy()}},{key:"remove",value:function(){return this.destroy()}}],[{key:"extend",value:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},{key:"clone",value:function(e){for(var t=window.AudioFXGlobal.context.createBuffer(e.numberOfChannels,e.length,e.sampleRate),i=0,o=e.numberOfChannels;o>i;++i){var n=t.getChannelData(i),r=e.getChannelData(i);n.set(r,0)}return t}},{key:"isObject",value:function(e){return null!==e&&"object"==typeof e}},{key:"isFunction",value:function(e){var t={};return e&&"[object Function]"===t.toString.call(e)}},{key:"error",value:function(e){throw new Error("AudioFX: Error! "+e)}}]),o}();return o});