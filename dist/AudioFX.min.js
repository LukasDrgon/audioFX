!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.AudioFX=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),i=function(){function i(t,o,n){e(this,i),this["const"]={QUALITY_MULTIPLIER:30};var r={loop:!1,filterFrequency:null};if(this.options=i.isObject(n)?i.extend(r,n):r,this.playing=!1,this.hasLoaded=!1,!window.AudioFXGlobal){window.AudioFXGlobal={};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioFXGlobal.context=new AudioContext}catch(s){i.error("Web Audio API Error: "+s.message)}}"string"!=typeof t?i.error("You have to provide a valid url string."):this.url=t,o&&(i.isFunction(o)?this.onload=o:i.error("Supplied callback is not a function.")),this.buffer=null,this.duration=0,this.source=null,window.AudioFXGlobal.context.createGain||(window.AudioFXGlobal.context.createGain=window.AudioFXGlobal.context.createGainNode),this.gainNode=window.AudioFXGlobal.context.createGain(),this.filterNode=window.AudioFXGlobal.context.createBiquadFilter(),this.filterNode.type="string"==typeof this.filterNode.type?"lowpass":0,this.filterNode.frequency.value=this.options.filterFrequency?this.options.filterFrequency:window.AudioFXGlobal.context.sampleRate,this._pauseTime=0,this.loadFile(t)}return t(i,[{key:"loadFile",value:function(e){this.request=new XMLHttpRequest,this.request.open("GET",e,!0),this.request.responseType="arraybuffer";var t=this;this.request.onload=function(){window.AudioFXGlobal.context.decodeAudioData(t.request.response,function(o){o||i.error("Error decoding file data: "+e),t.buffer=o,t.duration=parseFloat(o.duration),t.hasLoaded=!0,i.isFunction(t.onload)&&t.onload(t)},function(e){i.error("Error at decodeAudioData"+e)})},this.request.onerror=function(){i.error("XMLHttpRequest errored. Readystate: "+this.readyState+". Status: "+this.status)},this.request.send()}},{key:"createAndConnectNodes",value:function(){this.source=window.AudioFXGlobal.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.filterNode),this.filterNode.connect(this.gainNode),this.gainNode.connect(window.AudioFXGlobal.context.destination)}},{key:"play",value:function(){var e=void 0===arguments[0]?0:arguments[0];return this.playing===!0&&this.stop(),this.createAndConnectNodes(),this.options.loop&&(this.source.loop=!0),this.source.start||(this.source.start=this.source.noteOn),this._pauseTime?this.source.start(0,this._pauseTime):this.source.start(0,e),this._playTime=window.AudioFXGlobal.context.currentTime,this.playing=!0,this}},{key:"pause",value:function(){if(this._playTime){var e=window.AudioFXGlobal.context.currentTime-this._playTime;this._pauseTime=this._pauseTime+e,this.source.stop||(this.source.stop=this.source.noteOff),this.source.stop(),this.playing=!1}}},{key:"stop",value:function(){var e=void 0===arguments[0]?0:arguments[0];return this.source.stop||(this.source.stop=this.source.noteOff),this._pauseTime=null,this.source.stop(e),this.playing=!1,this}},{key:"toggle",value:function(){return this.playing===!0?this.pause():this.play(),this}},{key:"changeVolume",value:function(e){var t=parseFloat(e);return t>1?t=1:0>t&&(t=0),this.gainNode.gain.value=t*t,this}},{key:"changeFilter",value:function(e,t){var i=40,o=window.AudioFXGlobal.context.sampleRate/2,n=Math.log(o/i)/Math.LN2,r=Math.pow(2,n*(e-1));return this.filterNode.frequency.value=o*r,this.filterNode.Q.value=t*this["const"].QUALITY_MULTIPLIER,this}},{key:"getCurrentTime",value:function(){return this.playing?this._pauseTime+(window.AudioFXGlobal.context.currentTime-this._playTime):this._pauseTime}},{key:"getDuration",value:function(){return this.duration}},{key:"destroy",value:function(){this.playing&&this.stop();for(var e in this)this.hasOwnProperty(e)&&delete this[e]}},{key:"volume",value:function(e){return this.changeVolume(e)}},{key:"filter",value:function(e,t){return this.changeFilter(e,t)}},{key:"kill",value:function(){return this.destroy()}},{key:"remove",value:function(){return this.destroy()}}],[{key:"extend",value:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},{key:"isObject",value:function(e){return null!==e&&"object"==typeof e}},{key:"isFunction",value:function(e){var t={};return e&&"[object Function]"===t.toString.call(e)}},{key:"error",value:function(e){throw new Error("AudioFX: Error! "+e)}}]),i}();return i});